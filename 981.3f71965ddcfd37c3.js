"use strict";(self.webpackChunkdemo_app=self.webpackChunkdemo_app||[]).push([[981],{5635:(et,A,u)=>{function W(z){window.katoid&&window.katoid.recordEvent(z),window.gtag&&window.gtag("event",z)}u.d(A,{V:()=>W})},9046:(et,A,u)=>{u.d(A,{f:()=>C});var W=u(6814),z=u(1488),h=u(5879);const P=function(){return["/playground"]},B=function(){return["/custom-handles"]},Y=function(){return["/real-life-example"]},F=function(){return["/scroll-test"]},v=function(){return["/row-height-fit"]},D=function(){return["/multi-item-drag-and-resize"]};let C=(()=>{class y{constructor(){}static#t=this.\u0275fac=function(L){return new(L||y)};static#e=this.\u0275cmp=h.Xpm({type:y,selectors:[["ktd-footer"]],standalone:!0,features:[h.jDz],decls:15,vars:12,consts:[[2,"margin-top","16px"],[2,"display","flex","flex-direction","column"],[3,"routerLink"]],template:function(L,G){1&L&&(h.TgZ(0,"h2",0),h._uU(1,"Other examples: "),h.qZA(),h.TgZ(2,"div",1)(3,"a",2),h._uU(4,"Playground"),h.qZA(),h.TgZ(5,"a",2),h._uU(6,"Custom handles"),h.qZA(),h.TgZ(7,"a",2),h._uU(8,"Real life example"),h.qZA(),h.TgZ(9,"a",2),h._uU(10,"Scroll test"),h.qZA(),h.TgZ(11,"a",2),h._uU(12,"Row Height Fit"),h.qZA(),h.TgZ(13,"a",2),h._uU(14,"Multi Item Drag & Resize"),h.qZA()()),2&L&&(h.xp6(3),h.Q6J("routerLink",h.DdM(6,P)),h.xp6(2),h.Q6J("routerLink",h.DdM(7,B)),h.xp6(2),h.Q6J("routerLink",h.DdM(8,Y)),h.xp6(2),h.Q6J("routerLink",h.DdM(9,F)),h.xp6(2),h.Q6J("routerLink",h.DdM(10,v)),h.xp6(2),h.Q6J("routerLink",h.DdM(11,D)))},dependencies:[W.ez,z.Bz,z.rH],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   a[_ngcontent-%COMP%]{align-self:start;display:flex}"]})}return y})()},9016:(et,A,u)=>{u.d(A,{R:()=>Y});var W=u(4699),z=u(1280),h=u(8594),P=u(6124);function Y(y,k,M,L){return(0,h.m)(M)&&(L=M,M=void 0),L?Y(y,k,M).pipe((0,P.U)(G=>(0,z.k)(G)?L(...G):L(G))):new W.y(G=>{F(y,k,function X(O){G.next(arguments.length>1?Array.prototype.slice.call(arguments):O)},G,M)})}function F(y,k,M,L,G){let X;if(function C(y){return y&&"function"==typeof y.addEventListener&&"function"==typeof y.removeEventListener}(y)){const O=y;y.addEventListener(k,M,G),X=()=>O.removeEventListener(k,M,G)}else if(function D(y){return y&&"function"==typeof y.on&&"function"==typeof y.off}(y)){const O=y;y.on(k,M),X=()=>O.off(k,M)}else if(function v(y){return y&&"function"==typeof y.addListener&&"function"==typeof y.removeListener}(y)){const O=y;y.addListener(k,M),X=()=>O.removeListener(k,M)}else{if(!y||!y.length)throw new TypeError("Invalid event target");for(let O=0,yt=y.length;O<yt;O++)F(y[O],k,M,L,G)}L.add(X)}},3944:(et,A,u)=>{u.d(A,{Z:()=>B});var W=u(1618),h=u(1781);const B=new class P extends h.v{flush(v){this.active=!0,this.scheduled=void 0;const{actions:D}=this;let C,y=-1,k=D.length;v=v||D.shift();do{if(C=v.execute(v.state,v.delay))break}while(++y<k&&(v=D.shift()));if(this.active=!1,C){for(;++y<k&&(v=D.shift());)v.unsubscribe();throw C}}}(class z extends W.o{constructor(v,D){super(v,D),this.scheduler=v,this.work=D}requestAsyncId(v,D,C=0){return null!==C&&C>0?super.requestAsyncId(v,D,C):(v.actions.push(this),v.scheduled||(v.scheduled=requestAnimationFrame(()=>v.flush(null))))}recycleAsyncId(v,D,C=0){if(null!==C&&C>0||null===C&&this.delay>0)return super.recycleAsyncId(v,D,C);0===v.actions.length&&(cancelAnimationFrame(D),v.scheduled=void 0)}})},6745:(et,A,u)=>{u.d(A,{k:()=>z});var W=u(1280);function z(h){return!(0,W.k)(h)&&h-parseFloat(h)+1>=0}},9700:(et,A,u)=>{u.d(A,{Vh:()=>Je,D9:()=>Oe,Mc:()=>Jt,Rm:()=>Ae,SQ:()=>qe,ZE:()=>Te,zk:()=>Pe,jz:()=>Me,Yy:()=>De});var W=u(4917),z=u(1226);function h(t,e=z.E,n=z.E){return(0,W.P)(()=>t()?e:n)}var P=u(9016),B=u(7354),Y=u(4699),F=u(2079),v=u(5125),D=u(9918);const C=new Y.y(D.Z);var k=u(435),M=u(6745);function G(t){const{subscriber:e,counter:n,period:i}=t;e.next(n),this.schedule({subscriber:e,counter:n+1,period:i},i)}var X=u(3944),O=u(2994),yt=u(9193),U=u(7734),j=u(5222),lt=u(3075),Z=u(6124),ae=u(5253),wt=u(5846);function vt(t,e){return e?n=>n.pipe(vt((i,r)=>(0,ae.D)(t(i,r)).pipe((0,Z.U)((o,s)=>e(i,o,r,s))))):n=>n.lift(new le(t))}class le{constructor(e){this.project=e}call(e,n){return n.subscribe(new de(e,this.project))}}class de extends wt.Ds{constructor(e,n){super(e),this.project=n,this.hasSubscription=!1,this.hasCompleted=!1,this.index=0}_next(e){this.hasSubscription||this.tryNext(e)}tryNext(e){let n;const i=this.index++;try{n=this.project(e,i)}catch(r){return void this.destination.error(r)}this.hasSubscription=!0,this._innerSub(n)}_innerSub(e){const n=new wt.IY(this),i=this.destination;i.add(n);const r=(0,wt.ft)(e,n);r!==n&&i.add(r)}_complete(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()}}var xt=u(9352),he=u(1418),$t=u(7927),ce=u(2068),l=u(5879),bt=u(6814);const ue=["resizeElem"],Ot=["*"],fe=!1;function Tt(t){const e={w:t.w,h:t.h,x:t.x,y:t.y,id:t.id,moved:!!t.moved,static:!!t.static};return void 0!==t.minW&&(e.minW=t.minW),void 0!==t.maxW&&(e.maxW=t.maxW),void 0!==t.minH&&(e.minH=t.minH),void 0!==t.maxH&&(e.maxH=t.maxH),void 0!==t.isDraggable&&(e.isDraggable=t.isDraggable),void 0!==t.isResizable&&(e.isResizable=t.isResizable),e}function Et(t,e){return!(t.id===e.id||t.x+t.w<=e.x||t.x>=e.x+e.w||t.y+t.h<=e.y||t.y>=e.y+e.h)}function J(t,e,n){const i=function Wt(t){return t.filter(e=>e.static)}(t),r=i.length>1;r&&i.sort((a,d)=>a.y+a.h-(d.y+d.h));const o=nt(t,e),s=Array(t.length);for(let a=0,d=o.length;a<d;a++){let g=Tt(o[a]);g.static||(g=me(i,g,e,n,o,r),i.push(g)),s[t.indexOf(o[a])]=g,g.moved=!1}return s}const pe={x:"w",y:"h"};function Ct(t,e,n,i,r){const o=pe[i];e[i]+=1;const s=t.map(a=>a.id).indexOf(e.id);for(let a=s+1;a<t.length;a++){const d=t[a];if(!d.static){if(d[i]>(r??n)+e[o])break;Et(e,d)&&(r=Ct(t,d,n+e[o],i,r?r+e[o]:void 0))}}return e[i]=n,r}function me(t,e,n,i,r,o){const a="horizontal"===n;if("vertical"===n)for(e.y=Math.min(function ge(t){let n,e=0;for(let i=0,r=t.length;i<r;i++)n=t[i].y+t[i].h,n>e&&(e=n);return e}(t),e.y);e.y>0&&!V(t,e);)e.y--;else if(a)for(;e.x>0&&!V(t,e);)e.x--;let d,g;for(o&&t.forEach(x=>{(!g||x.y+x.h>g)&&(g=x.y+x.h)});d=V(t,e);)if(a?Ct(r,e,d.x+d.w,"x",g):Ct(r,e,d.y+d.h,"y",g),a&&e.x+e.w>i)for(e.x=i-e.w,e.y++;e.x>0&&!V(t,e);)e.x--;return e.y=Math.max(e.y,0),e.x=Math.max(e.x,0),e}function V(t,e){for(let n=0,i=t.length;n<i;n++)if(Et(t[n],e))return t[n];return null}function At(t,e){return t.filter(n=>Et(n,e))}function Rt(t,e,n,i,r,o,s,a){if(e.static&&!0!==e.isDraggable||e.y===i&&e.x===n)return t;dt(`Moving element ${e.id} to [${String(n)},${String(i)}] from [${e.x},${e.y}]`);const d=e.x,g=e.y;"number"==typeof n&&(e.x=n),"number"==typeof i&&(e.y=i),e.moved=!0;let x=nt(t,s);("vertical"===s&&"number"==typeof i?g>=i:"horizontal"===s&&"number"==typeof n&&d>=n)&&(x=x.reverse());const _=At(x,e);if(o&&_.length)return dt(`Collision prevented on ${e.id}, reverting.`),e.x=d,e.y=g,e.moved=!1,t;for(let w=0,p=_.length;w<p;w++){const R=_[w];dt(`Resolving collision between ${e.id} at [${e.x},${e.y}] and ${R.id} at [${R.x},${R.y}]`),!R.moved&&(t=R.static?Bt(t,R,e,r,s,a):Bt(t,e,R,r,s,a))}return t}function Bt(t,e,n,i,r,o){const s="horizontal"===r,a="horizontal"!==r,d=e.static;if(i){i=!1;const g={x:s?Math.max(e.x-n.w,0):n.x,y:a?Math.max(e.y-n.h,0):n.y,w:n.w,h:n.h,id:"-1"};if(!V(t,g))return dt(`Doing reverse collision on ${n.id} up to [${g.x},${g.y}].`),Rt(t,n,s?g.x:void 0,a?g.y:void 0,i,d,r,o)}return Rt(t,n,s?n.x+1:void 0,a?n.y+1:void 0,i,d,r,o)}function nt(t,e){return"horizontal"===e?function we(t){return[].concat(t).sort(function(e,n){return e.x>n.x||e.x===n.x&&e.y>n.y?1:-1})}(t):function ye(t){return[].concat(t).sort(function(e,n){return e.y>n.y||e.y===n.y&&e.x>n.x?1:e.y===n.y&&e.x===n.x?0:-1})}(t)}function dt(...t){fe&&console.log(...t)}let it;function ht(t){return function ve(){if(null==it&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>it=!0}))}finally{it=it||!1}return it}()?t:!!t.capture}const xe=ht({passive:!0}),rt=ht({passive:!1});let ct=null;function ut(){if(null!=ct)return ct;const t=/Android|webOS|BlackBerry|Windows Phone|iPad|iPhone|iPod/i.test(navigator.userAgent),e=/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1;return ct=t||e,ct}function ft(t){return null!=t.clientX}function Q(t){return ft(t)?t.clientX:t.touches[0].clientX}function N(t){return ft(t)?t.clientY:t.touches[0].clientY}function Yt(t){return{clientX:ft(t)?t.clientX:t.touches[0].clientX,clientY:ft(t)?t.clientY:t.touches[0].clientY}}function Ft(t){return"mousedown"===t.type||"pointerdown"===t.type&&"mouse"===t.pointerType}function gt(){return!!window.PointerEvent}function pt(t){return gt()?(0,P.R)(t,"pointerdown",rt).pipe((0,U.h)(e=>e.isPrimary&&0===e.button)):function be(t,e=1){return h(()=>ut(),(0,P.R)(t,"touchstart",xe).pipe((0,U.h)(n=>n.touches.length===e)),(0,P.R)(t,"mousedown",rt).pipe((0,U.h)(n=>0===n.button)))}(t)}function St(t){return gt()?(0,P.R)(t,"pointerup").pipe((0,U.h)(e=>e.isPrimary&&0===e.button)):function Re(t,e=1){return h(()=>ut(),function Ce(t,e=1){return(0,B.T)((0,P.R)(t,"touchend").pipe((0,U.h)(n=>n.touches.length===e-1)),(0,P.R)(t,"touchcancel").pipe((0,U.h)(n=>n.touches.length===e-1)))}(t,e),(0,P.R)(t,"mouseup"))}(t)}const Se=!1;function Dt(t,e,n,i,r){let o="vertical"===i?"y":"x";if(e.every(w=>w.l.y===w.y&&w.l.x===w.x))return t;const s=e[0].l.x,a=e[0].l.y,d={};e.forEach(w=>{d[w.l.id]={x:w.l.x,y:w.l.y},"number"==typeof w.x&&(w.l.x=w.x),"number"==typeof w.y&&(w.l.y=w.y),w.l.moved=!0});let _,g=nt(t,i),x=nt(e.map(w=>w.l),i);return("vertical"===i&&"number"==typeof e[0].y?a>=e[0].y:"horizontal"===i&&"number"==typeof e[0].x&&s>=e[0].x)&&(g=g.reverse()),x&&x.length&&(_=x[0][o]),x.forEach(w=>{const p=At(g,w);for(let R=0,I=p.length;R<I;R++){const c=p[R];Kt(`Resolving collision between ${w.id}] and ${c.id} at [${c.x},${c.y}]`),!c.moved&&(t=c.static&&!w.static?It(t,c,w,_===w[o]&&n,i,r):It(t,w,c,_===w[o]&&n,i,r))}}),t}function It(t,e,n,i,r,o){const s="horizontal"===r,a="horizontal"!==r;if(i){i=!1;const d={x:s?Math.max(e.x-n.w,0):n.x,y:a?Math.max(e.y-n.h,0):n.y,w:n.w,h:n.h,id:"-1"};if(!V(t,d))return Kt(`Doing reverse collision on ${n.id} up to [${d.x},${d.y}].`),Dt(t,[{l:n,x:s?d.x:void 0,y:a?d.y:void 0}],i,r,o)}return Dt(t,[{l:n,x:s?n.x+1:void 0,y:a?n.y+1:void 0}],i,r,o)}function Kt(...t){Se&&console.log(...t)}function De(t,e){return e.id}function ot(t,e,n){const i=t.reduce((s,a)=>Math.max(s,Math.max(a.y+a.h,0)),0);return(e-(i-1)*n)/i}function Pe(t,e,n){return J(t,e,n).map(i=>({id:i.id,x:i.x,y:i.y,w:i.w,h:i.h,minW:i.minW,minH:i.minH,maxW:i.maxW,maxH:i.maxH}))}function Me(t,e){return nt(t,e)}function Ut(t,e,n,i){return e<=1?0:Math.round(t/((n-i*(e-1))/e+i))}function Xt(t,e,n,i){return Math.round(t/(e+i))}function ke(t,e,n,i){const o=(n-i*(e-1))/e;return Math.round((t-o)/(o+i))+1}function He(t,e,n,i){return Math.round((t-e)/(e+i))+1}function _e(t,e,n,i){const{pointerDownEvent:r,pointerDragEvent:o,gridElemClientRect:s,dragElemClientRect:a,scrollDifference:d}=i,g=t.id,x=e.layout.find(H=>H.id===g),b=Q(r),_=N(r),w=Q(o),p=N(o),$=w-(s.left+d.left)-(b-a.left),m=p-(s.top+d.top)-(_-a.top),tt="fit"===e.rowHeight?ot(e.layout,e.height??s.height,e.gap):e.rowHeight,S={...x,x:Ut($,e.cols,s.width,e.gap),y:Xt(m,tt,0,e.gap)};S.x=Math.max(0,S.x),S.y=Math.max(0,S.y),S.x+S.w>e.cols&&(S.x=Math.max(0,e.cols-S.w));const K=e.layout,T=K.find(H=>H.id===g);let f=Rt(K,T,S.x,S.y,!0,e.preventCollision,n,e.cols);return f=J(f,n,e.cols),{layout:f,draggedItemPos:{top:m,left:$,width:a.width,height:a.height}}}function Le(t,e,n,i){const{pointerDownEvent:r,pointerDragEvent:o,gridElemClientRect:s,dragElemClientRect:a,scrollDifference:d}=i,g=t.id,x=Q(r),b=N(r),_=Q(o),w=N(o),p=a.width-(x-a.left),R=a.height-(b-a.top),I=e.layout.find(S=>S.id===g),c=_+p-(a.left+d.left),E=w+R-(a.top+d.top),$="fit"===e.rowHeight?ot(e.layout,e.height??s.height,e.gap):e.rowHeight,m={...I,w:ke(c,e.cols,s.width,e.gap),h:He(E,$,0,e.gap)};if(m.w=Zt(m.w,t.minW??m.minW,t.maxW??m.maxW),m.h=Zt(m.h,t.minH??m.minH,t.maxH??m.maxH),m.x+m.w>e.cols&&(m.w=Math.max(1,e.cols-m.x)),e.preventCollision){const S=m.w,K=m.h;let f,T=q(e.layout,m);for(;T;)f=Ge(m,f),m[f]--,T=q(e.layout,m);if("w"===f)for(m.h=K,T=q(e.layout,m);T;)m.h--,T=q(e.layout,m);if("h"===f)for(m.w=S,T=q(e.layout,m);T;)m.w--,T=q(e.layout,m)}return{layout:J(e.layout.map(S=>S.id===g?m:S),n,e.cols),draggedItemPos:{top:a.top-s.top,left:a.left-s.left,width:c,height:E}}}function q(t,e){return!!V(t,e)}function Ge(t,e){return t.h<=1?"w":t.w<=1||"w"===e?"h":"w"}function Zt(t,e=1,n=1/0){return Math.min(Math.max(t,e<1?1:e),n)}const Vt=new l.OlP("KtdGridDragHandle");let Oe=(()=>{class t{constructor(n){this.element=n}static#t=this.\u0275fac=function(i){return new(i||t)(l.Y36(l.SBq))};static#e=this.\u0275dir=l.lG2({type:t,selectors:[["","ktdGridDragHandle",""]],hostAttrs:[1,"ktd-grid-drag-handle"],standalone:!0,features:[l._Bn([{provide:Vt,useExisting:t}])]})}return t})();const Qt=new l.OlP("KtdGridResizeHandle");let Te=(()=>{class t{constructor(n){this.element=n}static#t=this.\u0275fac=function(i){return new(i||t)(l.Y36(l.SBq))};static#e=this.\u0275dir=l.lG2({type:t,selectors:[["","ktdGridResizeHandle",""]],hostAttrs:[1,"ktd-grid-resize-handle"],standalone:!0,features:[l._Bn([{provide:Qt,useExisting:t}])]})}return t})();const Nt=new l.OlP("KtdGridItemPlaceholder");let Ae=(()=>{class t{constructor(n){this.templateRef=n}static#t=this.\u0275fac=function(i){return new(i||t)(l.Y36(l.Rgc))};static#e=this.\u0275dir=l.lG2({type:t,selectors:[["ng-template","ktdGridItemPlaceholder",""]],hostAttrs:[1,"ktd-grid-item-placeholder-content"],inputs:{data:"data"},standalone:!0,features:[l._Bn([{provide:Nt,useExisting:t}])]})}return t})();function mt(t){return null!=t&&"false"!=`${t}`}function st(t,e=0){return function We(t){return!isNaN(parseFloat(t))&&!isNaN(Number(t))}(t)?Number(t):e}const jt=new l.OlP("GRID_ITEM_GET_RENDER_DATA_TOKEN"),Pt=ht({passive:!1,capture:!0});let Mt=(()=>{class t{constructor(n,i){this.ngZone=n,this.document=i,this.touchMoveSubject=new F.xQ,this.touchMove$=this.touchMoveSubject.asObservable(),this.registerTouchMoveSubscription()}ngOnDestroy(){this.touchMoveSubscription.unsubscribe()}mouseOrTouchMove$(n){return gt()?(0,P.R)(n,"pointermove",Pt):h(()=>ut(),this.touchMove$,(0,P.R)(n,"mousemove",Pt))}registerTouchMoveSubscription(){this.touchMoveSubscription=this.ngZone.runOutsideAngular(()=>(0,P.R)(this.document,"touchmove",Pt).pipe((0,U.h)(n=>1===n.touches.length)).subscribe(n=>this.touchMoveSubject.next(n)))}static#t=this.\u0275fac=function(i){return new(i||t)(l.LFG(l.R0b),l.LFG(bt.K0))};static#e=this.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Jt=(()=>{class t{get touchAction(){return this._draggable?"none":"auto"}get id(){return this._id}set id(n){this._id=n}get dragStartThreshold(){return this._dragStartThreshold}set dragStartThreshold(n){this._dragStartThreshold=st(n)}get draggable(){return this._draggable}set draggable(n){this._draggable=mt(n),this._draggable$.next(this._draggable)}get resizable(){return this._resizable}set resizable(n){this._resizable=mt(n),this._resizable$.next(this._resizable)}constructor(n,i,r,o,s,a){this.elementRef=n,this.gridService=i,this.renderer=r,this.ngZone=o,this.document=s,this.getItemRenderData=a,this.transition="transform 500ms ease, width 500ms ease, height 500ms ease",this._dragStartThreshold=0,this._draggable=!0,this._draggable$=new v.X(this._draggable),this._manualDragEvents$=new F.xQ,this._resizable=!0,this._resizable$=new v.X(this._resizable),this.dragStartSubject=new F.xQ,this.resizeStartSubject=new F.xQ,this.subscriptions=[],this.dragStart$=this.dragStartSubject.asObservable(),this.resizeStart$=this.resizeStartSubject.asObservable()}ngOnInit(){const n=this.getItemRenderData(this.id);this.setStyles(n)}ngAfterContentInit(){this.subscriptions.push(this._dragStart$().subscribe(this.dragStartSubject),this._resizeStart$().subscribe(this.resizeStartSubject))}ngOnDestroy(){this.subscriptions.forEach(n=>n.unsubscribe())}startDragManually(n){this._manualDragEvents$.next(n)}setStyles({top:n,left:i,width:r,height:o}){this.renderer.setStyle(this.elementRef.nativeElement,"transform",`translateX(${i}) translateY(${n})`),this.renderer.setStyle(this.elementRef.nativeElement,"display","block"),this.renderer.setStyle(this.elementRef.nativeElement,"transition",this.transition),null!=r&&this.renderer.setStyle(this.elementRef.nativeElement,"width",r),null!=o&&this.renderer.setStyle(this.elementRef.nativeElement,"height",o)}_dragStart$(){return(0,B.T)(this._manualDragEvents$,this._draggable$.pipe((0,j.w)(n=>n?this._dragHandles.changes.pipe((0,lt.O)(this._dragHandles),(0,j.w)(i=>h(()=>i.length>0,(0,B.T)(...i.toArray().map(r=>pt(r.element.nativeElement))),pt(this.elementRef.nativeElement)))):C))).pipe(vt(n=>{Ft(n)&&n.preventDefault();const i=Yt(n);return this.gridService.mouseOrTouchMove$(this.document).pipe((0,xt.R)(St(this.document)),function Be(t){return e=>new Y.y(n=>t.runOutsideAngular(()=>e.subscribe(n)))}(this.ngZone),(0,U.h)(r=>{r.preventDefault();const o=Yt(r);return Math.abs(i.clientX-o.clientX)+Math.abs(i.clientY-o.clientY)>=this.dragStartThreshold}),(0,he.q)(1),(0,Z.U)(()=>n))}))}_resizeStart$(){return this._resizable$.pipe((0,j.w)(n=>n?this._resizeHandles.changes.pipe((0,lt.O)(this._resizeHandles),(0,j.w)(i=>i.length>0?(this.renderer.setStyle(this.resizeElem.nativeElement,"display","none"),(0,B.T)(...i.toArray().map(r=>pt(r.element.nativeElement)))):(this.renderer.setStyle(this.resizeElem.nativeElement,"display","block"),pt(this.resizeElem.nativeElement))),(0,$t.b)(i=>{Ft(i)&&i.preventDefault()})):(this.renderer.setStyle(this.resizeElem.nativeElement,"display","none"),C)))}static#t=this.\u0275fac=function(i){return new(i||t)(l.Y36(l.SBq),l.Y36(Mt),l.Y36(l.Qsj),l.Y36(l.R0b),l.Y36(bt.K0),l.Y36(jt))};static#e=this.\u0275cmp=l.Xpm({type:t,selectors:[["ktd-grid-item"]],contentQueries:function(i,r,o){if(1&i&&(l.Suo(o,Nt,5),l.Suo(o,Vt,5),l.Suo(o,Qt,5)),2&i){let s;l.iGM(s=l.CRH())&&(r.placeholder=s.first),l.iGM(s=l.CRH())&&(r._dragHandles=s),l.iGM(s=l.CRH())&&(r._resizeHandles=s)}},viewQuery:function(i,r){if(1&i&&l.Gf(ue,7,l.SBq),2&i){let o;l.iGM(o=l.CRH())&&(r.resizeElem=o.first)}},hostVars:2,hostBindings:function(i,r){2&i&&l.Udp("touch-action",r.touchAction)},inputs:{minW:"minW",minH:"minH",maxW:"maxW",maxH:"maxH",transition:"transition",id:"id",dragStartThreshold:"dragStartThreshold",draggable:"draggable",resizable:"resizable"},standalone:!0,features:[l.jDz],ngContentSelectors:Ot,decls:3,vars:0,consts:[[1,"grid-item-resize-icon"],["resizeElem",""]],template:function(i,r){1&i&&(l.F$t(),l.Hsn(0),l._UZ(1,"div",0,1))},styles:['[_nghost-%COMP%]{display:none;position:absolute;z-index:1;overflow:hidden}[_nghost-%COMP%]   div[_ngcontent-%COMP%]{position:absolute;-webkit-user-select:none;user-select:none;z-index:10}[_nghost-%COMP%]   div.grid-item-resize-icon[_ngcontent-%COMP%]{cursor:se-resize;width:20px;height:20px;bottom:0;right:0;color:inherit}[_nghost-%COMP%]   div.grid-item-resize-icon[_ngcontent-%COMP%]:after{content:"";position:absolute;right:3px;bottom:3px;width:5px;height:5px;border-right:2px solid;border-bottom:2px solid}.display-none[_ngcontent-%COMP%]{display:none!important}'],changeDetection:0})}return t})();function kt(t){const e=t.getBoundingClientRect();return{top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height}}function te(t,e){t===window?t.scrollBy(0,e):t.scrollTop+=e}function ee(t,e){t===window?t.scrollBy(e,0):t.scrollLeft+=e}function Ue(t,e){let n,i,r;if(t===document){n=document.defaultView;const{width:o,height:s}=function ne(){const t=document.defaultView||window;return{width:t.innerWidth,height:t.innerHeight}}();i={width:o,height:s,top:0,right:o,bottom:s,left:0},r=function Ze(){return Math.max(document.body.scrollWidth,document.documentElement.scrollWidth)}()}else n=t,i=kt(t),r=t.scrollWidth;return null==(e=e||{}).disableHorizontal&&r<=i.width&&(e.disableHorizontal=!0),o=>o.pipe((0,Z.U)(({pointerX:s,pointerY:a})=>{let d=function Fe(t,e){const{top:n,bottom:i,height:r}=t,o=.05*r;return e>=n-o&&e<=n+o?1:e>=i-o&&e<=i+o?2:0}(i,a),g=function Ie(t,e){const{left:n,right:i,width:r}=t,o=.05*r;return e>=n-o&&e<=n+o?1:e>=i-o&&e<=i+o?2:0}(i,s);return e?.disableVertical&&(d=0),e?.disableHorizontal&&(g=0),{verticalScrollDirection:d,horizontalScrollDirection:g}}),(0,ce.x)((s,a)=>s.verticalScrollDirection===a.verticalScrollDirection&&s.horizontalScrollDirection===a.horizontalScrollDirection),(0,j.w)(({verticalScrollDirection:s,horizontalScrollDirection:a})=>s||a?function Ke(t,e,n,i=2){return function L(t=0,e=k.P){return(!(0,M.k)(t)||t<0)&&(t=0),(!e||"function"!=typeof e.schedule)&&(e=k.P),new Y.y(n=>(n.add(e.schedule(G,t,{subscriber:n,counter:0,period:t})),n))}(0,X.Z).pipe((0,$t.b)(()=>{1===e?te(t,-i):2===e&&te(t,i),1===n?ee(t,-i):2===n&&ee(t,i)}),function Ye(){return t=>t.pipe((0,U.h)(()=>!1))}())}(n,s,a,e?.scrollStep):C))}function Xe(t){let e;return e=t===document?Ht():{top:t.scrollTop,left:t.scrollLeft},(0,P.R)(t,"scroll",ht({capture:!0})).pipe((0,Z.U)(()=>{let n,i;if(t===document){const s=Ht();n=s.top,i=s.left}else n=t.scrollTop,i=t.scrollLeft;return{top:e.top-n,left:e.left-i}}))}function Ht(){const t=document.defaultView||window,e=document.documentElement,n=e.getBoundingClientRect();return{top:-n.top||document.body.scrollTop||t.scrollY||e.scrollTop||0,left:-n.left||document.body.scrollLeft||t.scrollX||e.scrollLeft||0}}function ie(t){const e=t.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(t)*e}function _t(t,e){return t.getPropertyValue(e).split(",").map(i=>i.trim())}function zt(t,e,n){return{layout:e,layoutItem:e.find(i=>i.id===t.id),gridItemRef:t,selectedItems:n&&n.map(i=>({layoutItem:e.find(r=>r.id===i.id),gridItemRef:i}))}}function re(t,e){const{rowHeight:n,layout:i,gap:r}=t;return"fit"===n?ot(i,e,r):n}function oe(t,e,n){const{layout:i,gap:r}=t,o=re(t,n),s=function Qe(t,e){const{cols:n,gap:i}=t;return(e-Math.max(i*(n-1),0))/n}(t,e),a={};for(const d of i)a[d.id]={id:d.id,top:d.y*o+r*d.y,left:d.x*s+r*d.x,width:d.w*s+r*Math.max(d.w-1,0),height:d.h*o+r*Math.max(d.h-1,0)};return a}function se(t,e,n){return t.reduce((i,r)=>Math.max(i,(r.y+r.h)*e+Math.max(r.y+r.h-1,0)*n),0)}function Lt(t){return{id:t.id,top:`${t.top}px`,left:`${t.left}px`,width:`${t.width}px`,height:`${t.height}px`}}function je(t){return function Ne(t){return function(e){return Lt(t.getItemRenderData(e))}}(t)}let Je=(()=>{class t{get compactOnPropsChange(){return this._compactOnPropsChange}set compactOnPropsChange(n){this._compactOnPropsChange=mt(n)}get preventCollision(){return this._preventCollision}set preventCollision(n){this._preventCollision=mt(n)}get scrollSpeed(){return this._scrollSpeed}set scrollSpeed(n){this._scrollSpeed=st(n,2)}get compactType(){return this._compactType}set compactType(n){this._compactType=n}get rowHeight(){return this._rowHeight}set rowHeight(n){this._rowHeight="fit"===n?n:Math.max(1,Math.round(st(n)))}get cols(){return this._cols}set cols(n){this._cols=Math.max(1,Math.round(st(n)))}get layout(){return this._layout}set layout(n){this._layout=n}get gap(){return this._gap}set gap(n){this._gap=Math.max(st(n),0)}get height(){return this._height}set height(n){this._height="number"==typeof n?Math.max(n,0):null}get selectedItemsIds(){return this._selectedItemsIds}set selectedItemsIds(n){this._selectedItemsIds=n,this.selectedItems=n?n.map(i=>this._gridItems.find(r=>r.id===i)):void 0}get backgroundConfig(){return this._backgroundConfig}set backgroundConfig(n){this._backgroundConfig=n;const i=this.elementRef.nativeElement.classList;null!==this._backgroundConfig?i.add("ktd-grid-background"):i.remove("ktd-grid-background"),this.setGridBackgroundVisible("always"===this._backgroundConfig?.show)}get config(){return{cols:this.cols,rowHeight:this.rowHeight,height:this.height,layout:this.layout,preventCollision:this.preventCollision,gap:this.gap}}constructor(n,i,r,o,s,a){this.gridService=n,this.elementRef=i,this.viewContainerRef=r,this.renderer=o,this.ngZone=s,this.document=a,this.layoutUpdated=new l.vpe,this.dragStarted=new l.vpe,this.resizeStarted=new l.vpe,this.dragEnded=new l.vpe,this.resizeEnded=new l.vpe,this.gridItemResize=new l.vpe,this.scrollableParent=null,this._compactOnPropsChange=!0,this._preventCollision=!1,this._scrollSpeed=2,this._compactType="vertical",this._rowHeight=100,this._cols=6,this._gap=0,this._height=null,this._backgroundConfig=null,this.placeholderRef={},this.placeholder={},this.subscriptions=[]}ngOnChanges(n){"fit"===this.rowHeight&&null==this.height&&console.warn("KtdGridComponent: The @Input() height should not be null when using rowHeight 'fit'");let i=!1,r=!1;(n.compactType||n.cols||n.layout)&&(i=!0),(i||n.rowHeight||n.height||n.gap||n.backgroundConfig)&&(r=!0),i&&this.compactOnPropsChange&&this.compactLayout(),r&&this.calculateRenderData()}ngAfterContentInit(){this.initSubscriptions()}ngAfterContentChecked(){this.render()}resize(){this.calculateRenderData(),this.render()}ngOnDestroy(){this.subscriptions.forEach(n=>n.unsubscribe())}compactLayout(){this.layout=J(this.layout,this.compactType,this.cols)}getItemsRenderData(){return{...this._gridItemsRenderData}}getItemRenderData(n){return this._gridItemsRenderData[n]}calculateRenderData(){const n=this.elementRef.nativeElement.getBoundingClientRect();this.gridCurrentHeight=this.height??("fit"===this.rowHeight?n.height:se(this.layout,this.rowHeight,this.gap)),this._gridItemsRenderData=oe(this.config,n.width,this.gridCurrentHeight),this.setBackgroundCssVariables(re(this.config,this.gridCurrentHeight))}render(){this.renderer.setStyle(this.elementRef.nativeElement,"height",`${this.gridCurrentHeight}px`),this.updateGridItemsStyles()}setBackgroundCssVariables(n){const i=this.elementRef.nativeElement.style;this._backgroundConfig?(i.setProperty("--gap",this.gap+"px"),i.setProperty("--row-height",n+"px"),i.setProperty("--columns",`${this.cols}`),i.setProperty("--border-width",(this._backgroundConfig.borderWidth??1)+"px"),i.setProperty("--border-color",this._backgroundConfig.borderColor??"#ffa72678"),i.setProperty("--gap-color",this._backgroundConfig.gapColor??"transparent"),i.setProperty("--row-color",this._backgroundConfig.rowColor??"transparent"),i.setProperty("--column-color",this._backgroundConfig.columnColor??"transparent")):(i.removeProperty("--gap"),i.removeProperty("--row-height"),i.removeProperty("--columns"),i.removeProperty("--border-width"),i.removeProperty("--border-color"),i.removeProperty("--gap-color"),i.removeProperty("--row-color"),i.removeProperty("--column-color"))}updateGridItemsStyles(){this._gridItems.forEach(n=>{const i=this._gridItemsRenderData[n.id];null==i?console.error(`Couldn't find the specified grid item for the id: ${n.id}`):n.setStyles(Lt(i))})}setGridBackgroundVisible(n){const i=this.elementRef.nativeElement.classList;n?i.add("ktd-grid-background-visible"):i.remove("ktd-grid-background-visible")}initSubscriptions(){this.subscriptions=[this._gridItems.changes.pipe((0,lt.O)(this._gridItems),(0,j.w)(n=>(0,B.T)(...n.map(i=>i.dragStart$.pipe((0,Z.U)(r=>({event:r,gridItem:i,type:"drag"})))),...n.map(i=>i.resizeStart$.pipe((0,Z.U)(r=>({event:r,gridItem:i,type:"resize"}))))).pipe(vt(({event:i,gridItem:r,type:o})=>{const s=this.selectedItems&&[...this.selectedItems];this.ngZone.run(()=>("drag"===o?this.dragStarted:this.resizeStarted).emit(zt(r,this.layout,s))),this.setGridBackgroundVisible("whenDragging"===this._backgroundConfig?.show||"always"===this._backgroundConfig?.show);let a=[r];return s&&s.some(d=>d.id===r.id)&&(a=s),this.performDragSequence$(a,i,o).pipe((0,Z.U)(d=>({layout:d,gridItem:r,type:o,multipleSelection:s})))})))).subscribe(({layout:n,gridItem:i,type:r,multipleSelection:o})=>{this.layout=n,this.calculateRenderData(),("drag"===r?this.dragEnded:this.resizeEnded).emit(zt(i,n,o)),this.layoutUpdated.emit(n),this.setGridBackgroundVisible("always"===this._backgroundConfig?.show)})]}performDragSequence$(n,i,r){return new Y.y(o=>{const s="string"==typeof this.scrollableParent?this.document.getElementById(this.scrollableParent):this.scrollableParent,a=kt(this.elementRef.nativeElement),d={},g={};let b,x={};n.forEach(p=>{d[p.id]=kt(p.elementRef.nativeElement),this.renderer.addClass(p.elementRef.nativeElement,"no-transitions"),this.renderer.addClass(p.elementRef.nativeElement,"ktd-grid-item-dragging");const R={...d[p.id],left:d[p.id].left-a.left,top:d[p.id].top-a.top};this.createPlaceholderElement(p.id,R,p.placeholder)});const _=this.ngZone.runOutsideAngular(()=>(s?this.gridService.mouseOrTouchMove$(this.document).pipe((0,Z.U)(p=>({pointerX:Q(p),pointerY:N(p)})),Ue(s,{scrollStep:this.scrollSpeed})):C).pipe((0,xt.R)(St(this.document))).subscribe()),w=this.ngZone.runOutsideAngular(()=>(0,B.T)((0,O.aj)([this.gridService.mouseOrTouchMove$(this.document),...s?[Xe(s).pipe((0,lt.O)({top:0,left:0}))]:[(0,yt.of)({top:0,left:0})]])).pipe((0,xt.R)(St(this.document))).subscribe(([p,R])=>{p.preventDefault();const I=b||this.layout;if("drag"===r&&n.length>1){const{layout:c,draggedItemPos:E}=function ze(t,e,n,i){const{pointerDownEvent:r,pointerDragEvent:o,gridElemClientRect:s,dragElementsClientRect:a,scrollDifference:d}=i,g={};t.forEach(f=>{g[f.id]=e.layout.find(H=>H.id===f.id)});const x=Q(r),b=N(r),_=Q(o),w=N(o),p=s.left+d.left,R=s.top+d.top,I="fit"===e.rowHeight?ot(e.layout,e.height??s.height,e.gap):e.rowHeight,c={},E={};let $=0,m=0;t.forEach(f=>{E[f.id]={x:_-p-(x-a[f.id].left),y:w-R-(b-a[f.id].top)},c[f.id]={...g[f.id],x:Ut(E[f.id].x,e.cols,s.width,e.gap),y:Xt(E[f.id].y,I,0,e.gap)},0>c[f.id].x&&$>c[f.id].x&&($=c[f.id].x),0>c[f.id].y&&m>c[f.id].y&&(m=c[f.id].y),c[f.id].x+c[f.id].w>e.cols&&$<c[f.id].w+c[f.id].x-e.cols&&($=c[f.id].w+c[f.id].x-e.cols)}),Object.entries(c).forEach(([f,H])=>{c[f]={...H,x:H.x-$,y:H.y-m}});const tt=e.layout,S=t.map(f=>{const H=tt.find(Gt=>Gt.id===f.id);return H.static=!0,{l:H,x:c[f.id].x,y:c[f.id].y}});let K=Dt(tt,S,!0,n,e.cols);K=J(K,n,e.cols),t.forEach(f=>K.find(H=>H.id===f.id).static=!1),K=J(K,n,e.cols);const T={};return t.forEach(f=>T[f.id]={left:E[f.id].x,top:E[f.id].y,width:a[f.id].width,height:a[f.id].height}),{layout:K,draggedItemPos:T}}(n,{layout:I,rowHeight:this.rowHeight,height:this.height,cols:this.cols,preventCollision:this.preventCollision,gap:this.gap},this.compactType,{pointerDownEvent:i,pointerDragEvent:p,gridElemClientRect:a,dragElementsClientRect:d,scrollDifference:R});b=c,x=E}else{const c="drag"===r?_e:Le;b=I,n.forEach(E=>{const{layout:$,draggedItemPos:m}=c(E,{layout:b,rowHeight:this.rowHeight,height:this.height,cols:this.cols,preventCollision:this.preventCollision,gap:this.gap},this.compactType,{pointerDownEvent:i,pointerDragEvent:p,gridElemClientRect:a,dragElemClientRect:d[E.id],scrollDifference:R});b=$,x[E.id]=m})}this.gridCurrentHeight=this.height??("fit"===this.rowHeight?a.height:se(b,this.rowHeight,this.gap)),this._gridItemsRenderData=oe({cols:this.cols,rowHeight:this.rowHeight,height:this.height,layout:b,preventCollision:this.preventCollision,gap:this.gap},a.width,a.height),n.forEach(c=>{g[c.id]={...this._gridItemsRenderData[c.id]};const E=Lt(g[c.id]);this.placeholder[c.id].style.width=E.width,this.placeholder[c.id].style.height=E.height,this.placeholder[c.id].style.transform=`translateX(${E.left}) translateY(${E.top})`,this._gridItemsRenderData[c.id]={...x[c.id],id:this._gridItemsRenderData[c.id].id}}),this.setBackgroundCssVariables("fit"===this.rowHeight?ot(b,a.height,this.gap):this.rowHeight),this.render(),n.forEach(c=>{"resize"===r&&(function $e(t,e){return t.id===e.id&&t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}(I.find(m=>m.id===c.id),b.find(m=>m.id===c.id))||this.gridItemResize.emit({width:g[c.id].width,height:g[c.id].height,gridItemRef:zt(c,b).gridItemRef}))})},p=>o.error(p),()=>{this.ngZone.run(()=>{n.forEach(p=>{this.renderer.removeClass(p.elementRef.nativeElement,"no-transitions"),this.renderer.removeClass(p.elementRef.nativeElement,"ktd-grid-item-dragging"),this.addGridItemAnimatingClass(p).subscribe(),this.destroyPlaceholder(p.id)}),o.next(b?b.map(p=>({id:p.id,x:p.x,y:p.y,w:p.w,h:p.h,minW:p.minW,minH:p.minH,maxW:p.maxW,maxH:p.maxH})):this.layout),o.complete()})}));return()=>{_.unsubscribe(),w.unsubscribe()}})}addGridItemAnimatingClass(n){return new Y.y(i=>{const r=function Ve(t){const e=getComputedStyle(t),n=_t(e,"transition-property"),i=n.find(a=>"transform"===a||"all"===a);if(!i)return 0;const r=n.indexOf(i),o=_t(e,"transition-duration"),s=_t(e,"transition-delay");return ie(o[r])+ie(s[r])}(n.elementRef.nativeElement);if(0===r)return i.next(),void i.complete();this.renderer.addClass(n.elementRef.nativeElement,"ktd-grid-item-animating");const o=d=>{(!d||d.target===n.elementRef.nativeElement&&"transform"===d.propertyName)&&(this.renderer.removeClass(n.elementRef.nativeElement,"ktd-grid-item-animating"),a(),clearTimeout(s),i.next(),i.complete())},s=setTimeout(o,1.5*r),a=this.renderer.listen(n.elementRef.nativeElement,"transitionend",o)})}createPlaceholderElement(n,i,r){this.placeholder[n]=this.renderer.createElement("div"),this.placeholder[n].style.width=`${i.width}px`,this.placeholder[n].style.height=`${i.height}px`,this.placeholder[n].style.transform=`translateX(${i.left}px) translateY(${i.top}px)`,this.placeholder[n].classList.add("ktd-grid-item-placeholder"),this.renderer.appendChild(this.elementRef.nativeElement,this.placeholder[n]),r?(this.placeholderRef[n]=this.viewContainerRef.createEmbeddedView(r.templateRef,r.data),this.placeholderRef[n].rootNodes.forEach(o=>this.placeholder[n].appendChild(o)),this.placeholderRef[n].detectChanges()):this.placeholder[n].classList.add("ktd-grid-item-placeholder-default")}destroyPlaceholder(n){this.placeholder[n]?.remove(),this.placeholderRef[n]?.destroy(),this.placeholder[n]=this.placeholderRef[n]=null}static#t=this.\u0275fac=function(i){return new(i||t)(l.Y36(Mt),l.Y36(l.SBq),l.Y36(l.s_b),l.Y36(l.Qsj),l.Y36(l.R0b),l.Y36(bt.K0))};static#e=this.\u0275cmp=l.Xpm({type:t,selectors:[["ktd-grid"]],contentQueries:function(i,r,o){if(1&i&&l.Suo(o,Jt,5),2&i){let s;l.iGM(s=l.CRH())&&(r._gridItems=s)}},inputs:{scrollableParent:"scrollableParent",compactOnPropsChange:"compactOnPropsChange",preventCollision:"preventCollision",scrollSpeed:"scrollSpeed",compactType:"compactType",rowHeight:"rowHeight",cols:"cols",layout:"layout",gap:"gap",height:"height",selectedItemsIds:"selectedItemsIds",backgroundConfig:"backgroundConfig"},outputs:{layoutUpdated:"layoutUpdated",dragStarted:"dragStarted",resizeStarted:"resizeStarted",dragEnded:"dragEnded",resizeEnded:"resizeEnded",gridItemResize:"gridItemResize"},standalone:!0,features:[l._Bn([{provide:jt,useFactory:je,deps:[t]}]),l.TTD,l.jDz],ngContentSelectors:Ot,decls:1,vars:0,template:function(i,r){1&i&&(l.F$t(),l.Hsn(0))},styles:['ktd-grid{display:block;position:relative;width:100%}ktd-grid.ktd-grid-background:before{content:"";border:none;position:absolute;inset:0;z-index:0;transition:opacity .2s;opacity:0;background-image:repeating-linear-gradient(var(--border-color) 0 var(--border-width),var(--row-color) var(--border-width) calc(var(--row-height) - var(--border-width)),var(--border-color) calc(var(--row-height) - var(--border-width)) calc(var(--row-height)),var(--gap-color) calc(var(--row-height)) calc(var(--row-height) + var(--gap))),repeating-linear-gradient(90deg,var(--border-color) 0 var(--border-width),var(--column-color) var(--border-width) calc(100% - (var(--border-width) + var(--gap))),var(--border-color) calc(100% - (var(--border-width) + var(--gap))) calc(100% - var(--gap)),var(--gap-color) calc(100% - var(--gap)) 100%);background-size:calc((100% + var(--gap)) / var(--columns)) calc(var(--row-height) + var(--gap));background-position:0 0}ktd-grid.ktd-grid-background.ktd-grid-background-visible:before{opacity:1}ktd-grid ktd-grid-item.ktd-grid-item-dragging,ktd-grid ktd-grid-item.ktd-grid-item-animating{z-index:1000}ktd-grid ktd-grid-item.no-transitions{transition:none!important}ktd-grid .ktd-grid-item-placeholder{position:absolute;z-index:0;transition-property:transform;transition:all .15s ease}ktd-grid .ktd-grid-item-placeholder-default{background-color:#8b0000;opacity:.6}\n'],encapsulation:2,changeDetection:0})}return t})(),qe=(()=>{class t{static#t=this.\u0275fac=function(i){return new(i||t)};static#e=this.\u0275mod=l.oAB({type:t});static#n=this.\u0275inj=l.cJS({providers:[Mt]})}return t})()}}]);